<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: center;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }
        
        .data-table tr:hover {
            background: #f5f5f5;
        }
        
        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .badge.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge.approved {
            background: #d4edda;
            color: #155724;
        }
        
        .badge.rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 2px;
        }
        
        .btn-approve {
            background: #28a745;
            color: white;
        }
        
        .btn-reject {
            background: #dc3545;
            color: white;
        }
        
        .search-box {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .search-box input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .search-box button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 5px;
        }
        
        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <h1>ğŸ‘‘ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù</h1>
        
        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ stats.total_users }}</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.total_points }}</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.pending_charges }}</div>
                <div class="stat-label">Ø·Ù„Ø¨Ø§Øª Ø´Ø­Ù† Ù…Ø¹Ù„Ù‚Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.active_today }}</div>
                <div class="stat-label">Ù†Ø´Ø· Ø§Ù„ÙŠÙˆÙ…</div>
            </div>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
        <div class="admin-tabs">
            <button class="tab-btn active" onclick="showTab('users')">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
            <button class="tab-btn" onclick="showTab('charges')">ğŸ’° Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø­Ù†</button>
            <button class="tab-btn" onclick="showTab('transactions')">ğŸ“ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</button>
            <button class="tab-btn" onclick="showTab('games')">ğŸ® Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</button>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
        <div id="tab-users" class="tab-content active">
            <div class="search-box">
                <input type="text" id="user-search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ù…Ø¹Ø±Ù...">
                <button onclick="searchUsers()">ğŸ” Ø¨Ø­Ø«</button>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>Ø§Ù„Ù…Ø¹Ø±Ù</th>
                        <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                        <th>Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="users-table-body">
                    {% for user in users %}
                    <tr>
                        <td>{{ user[0] }}</td>
                        <td>{{ user[3] }}</td>
                        <td>@{{ user[2] }}</td>
                        <td>{{ user[4] }}</td>
                        <td>{{ user[5] }}</td>
                        <td>{{ user[7][:10] }}</td>
                        <td>
                            <button class="action-btn" onclick="viewUser({{ user[0] }})">ğŸ‘ï¸</button>
                            <button class="action-btn" onclick="adjustPoints({{ user[0] }})">ğŸ’°</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <div class="pagination">
                {% for p in range(1, total_pages+1) %}
                <button class="page-btn {% if p == current_page %}active{% endif %}" 
                        onclick="loadPage({{ p }})">{{ p }}</button>
                {% endfor %}
            </div>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø­Ù† -->
        <div id="tab-charges" class="tab-content">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                        <th>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</th>
                        <th>Ø§Ù„Ø±Ù‚Ù…</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in charge_requests %}
                    <tr>
                        <td>{{ req[0] }}</td>
                        <td>{{ req[3] }}</td>
                        <td>{{ req[4] }} Ù„.Ø³</td>
                        <td>{{ req[5] }}</td>
                        <td>{{ req[6] }}</td>
                        <td>{{ req[7] }}</td>
                        <td>
                            <span class="badge {{ req[8] }}">{{ req[8] }}</span>
                        </td>
                        <td>{{ req[9][:16] }}</td>
                        <td>
                            {% if req[8] == 'pending' %}
                            <button class="action-btn btn-approve" onclick="approveCharge({{ req[0] }})">âœ…</button>
                            <button class="action-btn btn-reject" onclick="rejectCharge({{ req[0] }})">âŒ</button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª -->
        <div id="tab-transactions" class="tab-content">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„ÙˆØµÙ</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    </tr>
                </thead>
                <tbody>
                    {% for trans in transactions %}
                    <tr>
                        <td>{{ trans[3] }}</td>
                        <td>{{ trans[4] }}</td>
                        <td>{{ trans[5] }}</td>
                        <td>{{ trans[6] }}</td>
                        <td>{{ trans[7][:16] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        function showTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© active Ù…Ù† ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
        }
        
        function searchUsers() {
            const query = document.getElementById('user-search').value;
            if (query.length < 2) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            fetch(`/admin/search_users?q=${query}`)
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('users-table-body');
                    tbody.innerHTML = '';
                    
                    data.users.forEach(user => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${user[0]}</td>
                                <td>${user[3]}</td>
                                <td>@${user[2]}</td>
                                <td>${user[4]}</td>
                                <td>${user[5]}</td>
                                <td>${user[7].substring(0,10)}</td>
                                <td>
                                    <button class="action-btn" onclick="viewUser(${user[0]})">ğŸ‘ï¸</button>
                                    <button class="action-btn" onclick="adjustPoints(${user[0]})">ğŸ’°</button>
                                </td>
                            </tr>
                        `;
                    });
                });
        }
        
        function approveCharge(requestId) {
            if (confirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù†ØŸ')) {
                fetch(`/admin/approve_charge/${requestId}`, { method: 'POST' })
                    .then(() => location.reload());
            }
        }
        
        function rejectCharge(requestId) {
            if (confirm('ØªØ£ÙƒÙŠØ¯ Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù†ØŸ')) {
                fetch(`/admin/reject_charge/${requestId}`, { method: 'POST' })
                    .then(() => location.reload());
            }
        }
        
        function viewUser(userId) {
            window.location.href = `/admin/user/${userId}`;
        }
        
        function adjustPoints(userId) {
            const points = prompt('Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· (Ù…ÙˆØ¬Ø¨ Ù„Ù„Ø¥Ø¶Ø§ÙØ©ØŒ Ø³Ø§Ù„Ø¨ Ù„Ù„Ø®ØµÙ…):');
            if (points && !isNaN(points)) {
                fetch('/admin/adjust_points', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, points: parseInt(points) })
                }).then(() => location.reload());
            }
        }
        
        function loadPage(page) {
            window.location.href = `/admin?page=${page}`;
        }
    </script>
</body>
</html>