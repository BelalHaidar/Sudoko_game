<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¹Ø¨ Ø³ÙˆØ¯ÙˆÙƒÙˆ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h2>ğŸ¯ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø³ÙˆØ¯ÙˆÙƒÙˆ</h2>
            <div class="game-info">
                <span>Ø§Ù„ØµØ¹ÙˆØ¨Ø©: <strong>{{ difficulty }}</strong></span>
                <button onclick="checkSolution()" class="check-btn">âœ” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù„</button>
            </div>
        </div>
        
        <div class="sudoku-grid">
            <table id="sudoku-board">
                {% for i in range(9) %}
                <tr>
                    {% for j in range(9) %}
                    <td class="cell {% if puzzle[i][j] != 0 %}fixed{% endif %}">
                        {% if puzzle[i][j] != 0 %}
                            {{ puzzle[i][j] }}
                        {% else %}
                            <input type="text" 
                                   class="cell-input" 
                                   data-row="{{ i }}" 
                                   data-col="{{ j }}"
                                   maxlength="1"
                                   oninput="this.value=this.value.replace(/[^1-9]/g,'')">
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>
        </div>
        
        <div class="game-controls">
            <button onclick="clearBoard()" class="control-btn">ğŸ—‘ Ù…Ø³Ø­</button>
            <button onclick="newGame()" class="control-btn">ğŸ² Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button onclick="showHint()" class="control-btn">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
        </div>
        
        <div id="message" class="message"></div>
    </div>
    
    <script>
        const gameId = {{ game_id }};
        const userId = {{ user_id }};
        
        function getBoard() {
            const board = [];
            for (let i = 0; i < 9; i++) {
                const row = [];
                for (let j = 0; j < 9; j++) {
                    const cell = document.querySelector(`input[data-row="${i}"][data-col="${j}"]`);
                    if (cell) {
                        row.push(parseInt(cell.value) || 0);
                    } else {
                        const fixedCell = document.querySelector(`tr:nth-child(${i+1}) td:nth-child(${j+1})`);
                        row.push(parseInt(fixedCell.textContent) || 0);
                    }
                }
                board.push(row);
            }
            return board;
        }
        
        function checkSolution() {
            const board = getBoard();
            
            fetch('/check_solution', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    board: board,
                    game_id: gameId,
                    user_id: userId
                })
            })
            .then(response => response.json())
            .then(data => {
                const messageDiv = document.getElementById('message');
                messageDiv.textContent = data.message;
                messageDiv.className = data.success ? 'message success' : 'message error';
                
                if (data.success) {
                    setTimeout(() => {
                        window.location.href = '/play?user=' + userId;
                    }, 3000);
                }
            });
        }
        
        function clearBoard() {
            const inputs = document.querySelectorAll('.cell-input');
            inputs.forEach(input => input.value = '');
        }
        
        function newGame() {
            window.location.href = '/play?user=' + userId;
        }
        
        function showHint() {
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ù‡Ù†Ø§
            alert('ğŸš§ Ù‚Ø±ÙŠØ¨Ø§Ù‹...');
        }
    </script>
</body>
</html>