<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุดุญู ุงูููุงุท</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h2>๐ฐ ุดุญู ุงูููุงุท</h2>
        
        <div class="payment-methods">
            <h3>ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน:</h3>
            
            <div class="method-card" onclick="selectMethod('syriatel')">
                <div class="method-icon">๐ฑ</div>
                <h4>ุณูุฑูุงุชูู ูุงุด</h4>
                <p>ุงุดุญู ุนุจุฑ ูุญูุธุฉ ุณูุฑูุงุชูู ูุงุด</p>
                <small>ุชุญููู ููุฑู</small>
            </div>
            
            <div class="method-card" onclick="selectMethod('mtn')">
                <div class="method-icon">๐ฒ</div>
                <h4>MTN Cash</h4>
                <p>ุงุดุญู ุนุจุฑ ูุญูุธุฉ MTN Cash</p>
                <small>ุชุญููู ููุฑู</small>
            </div>
            
            <div class="method-card" onclick="selectMethod('sham')">
                <div class="method-icon">๐ณ</div>
                <h4>Sham Cash</h4>
                <p>ุงุดุญู ุนุจุฑ ูุญูุธุฉ Sham Cash</p>
                <small>ุชุญููู ููุฑู</small>
            </div>
        </div>
        
        <div id="payment-form" style="display: none;">
            <h3>ุฃุฏุฎู ุจูุงูุงุช ุงูุฏูุน:</h3>
            
            <form id="charge-form" onsubmit="processPayment(event)">
                <input type="hidden" id="selected-method" name="method">
                
                <div class="form-group">
                    <label for="phone">ุฑูู ุงููุงุชู:</label>
                    <input type="text" id="phone" name="phone" required pattern="[0-9]{10}" placeholder="09xxxxxxxx" maxlength="10">
                    <small>ุฃุฏุฎู ุฑูู ุงููุงุชู ุงููุฑุชุจุท ุจุงููุญูุธุฉ</small>
                </div>
                
                <div class="form-group">
                    <label for="amount">ุงููุจูุบ (ู.ุณ):</label>
                    <select id="amount" name="amount" required>
                        <option value="">ุงุฎุชุฑ ุงูุจุงูุฉ</option>
                        <option value="1000">1000 ู.ุณ = 100 ููุทุฉ</option>
                        <option value="2500">2500 ู.ุณ = 250 ููุทุฉ + 25 ููุทุฉ ูุฏูุฉ</option>
                        <option value="5000">5000 ู.ุณ = 500 ููุทุฉ + 75 ููุทุฉ ูุฏูุฉ</option>
                        <option value="10000">10000 ู.ุณ = 1000 ููุทุฉ + 200 ููุทุฉ ูุฏูุฉ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="code">ุฑูุฒ ุงูุชุฃููุฏ:</label>
                    <input type="text" id="code" name="code" required pattern="[0-9]{6}" placeholder="ุฃุฏุฎู ุงูุฑูุฒ ุงููุฑุณู ุฅูู ูุงุชูู">
                    <small>ุณูุชู ุฅุฑุณุงู ุฑูุฒ ุชุฃููุฏ ุฅูู ูุงุชูู</small>
                </div>
                
                <button type="submit" class="pay-btn">ุชุฃููุฏ ุงูุฏูุน</button>
            </form>
        </div>
        
        <div id="payment-result" class="message" style="display: none;"></div>
        
        <div class="charge-actions">
            <a href="/" class="back-btn">๐ ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</a>
            <a href="/play?user={{ user_id }}" class="play-btn">๐ฏ ุงูุนุจ ุงูุขู</a>
        </div>
    </div>
    
    <script>
        var userId = {{ user_id }};
        var selectedMethod = '';
        
        function selectMethod(method) {
            selectedMethod = method;
            document.getElementById('selected-method').value = method;
            document.getElementById('payment-form').style.display = 'block';
            
            // ุฅุฒุงูุฉ ุงูุชุญุฏูุฏ ุงูุณุงุจู
            var cards = document.querySelectorAll('.method-card');
            for (var i = 0; i < cards.length; i++) {
                cards[i].classList.remove('selected');
            }
            
            // ุชุญุฏูุฏ ุงูุจุทุงูุฉ ุงููุฎุชุงุฑุฉ
            event.currentTarget.classList.add('selected');
            
            // ุชูุฑูุฑ ูุฃุนูู ุงููููุฐุฌ
            document.getElementById('payment-form').scrollIntoView({ behavior: 'smooth' });
        }
        
        function processPayment(event) {
            event.preventDefault();
            
            var method = document.getElementById('selected-method').value;
            var amount = document.getElementById('amount').value;
            var phone = document.getElementById('phone').value;
            var code = document.getElementById('code').value;
            
            if (!method || !amount || !phone || !code) {
                showResult('โ ุงูุฑุฌุงุก ููุก ุฌููุน ุงูุญููู', 'error');
                return;
            }
            
            if (phone.length !== 10) {
                showResult('โ ุฑูู ุงููุงุชู ูุฌุจ ุฃู ูููู 10 ุฃุฑูุงู', 'error');
                return;
            }
            
            if (code.length !== 6) {
                showResult('โ ุฑูุฒ ุงูุชุฃููุฏ ูุฌุจ ุฃู ูููู 6 ุฃุฑูุงู', 'error');
                return;
            }
            
            // ุฅุธูุงุฑ ุฑุณุงูุฉ ุงูุชุญููู
            showResult('๐ ุฌุงุฑู ูุนุงูุฌุฉ ุงูุฏูุน...', 'info');
            
            // ูุญุงูุงุฉ ุนูููุฉ ุงูุฏูุน
            setTimeout(function() {
                fetch('/process_charge', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        method: method,
                        amount: amount,
                        phone: phone
                    })
                })
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    if (data.success) {
                        showResult('โ ุชูุช ุนูููุฉ ุงูุดุญู ุจูุฌุงุญ! ุฑุตูุฏู ุงูุฌุฏูุฏ: ' + data.new_points + ' ููุทุฉ', 'success');
                        
                        // ุฅุฎูุงุก ุงููููุฐุฌ
                        document.getElementById('payment-form').style.display = 'none';
                        
                        // ุชุญุฏูุซ ุฑุงุจุท ุงููุนุจ
                        setTimeout(function() {
                            window.location.href = '/play?user=' + userId;
                        }, 3000);
                    } else {
                        showResult('โ ูุดูุช ุนูููุฉ ุงูุดุญู. ุญุงูู ูุฑุฉ ุฃุฎุฑู.', 'error');
                    }
                })
                .catch(function(error) {
                    showResult('โ ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู. ุญุงูู ูุฑุฉ ุฃุฎุฑู.', 'error');
                });
            }, 2000);
        }
        
        function showResult(message, type) {
            var resultDiv = document.getElementById('payment-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'message ' + type;
            resultDiv.textContent = message;
        }
        
        // ุงูุชุญูู ูู ุฑูู ุงููุงุชู ุฃุซูุงุก ุงููุชุงุจุฉ
        document.getElementById('phone').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
        
        document.getElementById('code').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    </script>
</body>
</html>